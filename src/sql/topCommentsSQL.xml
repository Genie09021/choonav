<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="topComments">

    
    <!-- 댓글 목록 -->
    <select id="reply" resultType="topCommentsDTO">
    	SELECT
    		  topNum,topComNum, topComment, userId, topReg
    	 FROM topcomments
    	WHERE topNum = #{topNum} ORDER BY topComNum desc
	</select>	
    
    <!-- 댓글 입력 -->
    <insert id="insert" parameterType="topCommentsDTO">
    	<selectKey keyProperty="topComNum" order="BEFORE" resultType="int">
			select "topcomments_SEQ".nextVal from dual
		</selectKey>
        INSERT INTO topcomments (topComNum, topNum, topComment, userId, topReg, code)
        VALUES (#{topComNum}, #{topNum}, #{topComment}, #{userId}, sysdate, #{code})
	</insert>
	
	<!-- 댓글 작성시 해당게시글 댓글 수 +1 -->
	<update id="upRecnt" parameterType="int">
		update topic set recnt = recnt+1 where topNum = #{value}
	</update> 

	
	<!-- 댓글 삭제 -->
	<delete id="delete" parameterType="topCommentsDTO">
		delete from topcomments where topComNum = #{topComNum}
	</delete>
	
	<!-- 댓글 삭제시 게시글 댓글수 -1 -->
	<update id="downRecnt" parameterType="int">
		update topic set recnt = recnt-1 where topNum = #{value}
	</update>
</mapper>